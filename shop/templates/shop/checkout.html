{% extends 'shop/basic.html' %}
{% block title %} Check out page {% endblock %}
{% block css %}
<style>
  .bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  .container {
    max-width: 960px;
  }
  #shopnow{
    text-decoration: none;
  }
</style>

{% endblock %}


{% block body%}

<body class="bg-light">

  <div class="container my-5">
    <main>

      <div class="row g-5">
        <div class="col-md-5 col-lg-4 order-md-last">
          <h4 class="d-flex justify-content-between align-items-center">
            <p class="text-primary my-2">Item in your cart </p>
          </h4>
          <div>
            <ul class="list-group mb-3" id="items">

            </ul>

          </div>

        </div>
        <div class="col-md-7 col-lg-8">
          <h4 class="mb-3 text-primary my-2">Billing address</h4>
          <form class="needs-validation" novalidate action="/shop/checkout/" method="POST"> {% csrf_token %}
            <input type="hidden" name="item_json" id="item_json">
            <div class="row g-3">
              <div class="col-sm-6">
                <label for="firstName" class="form-label text-primary">First name</label>
                <input type="text" class="form-control" id="first_name" name="firist_name" placeholder="" value=""
                  required>
                <div class="invalid-feedback">
                  first name is required.
                </div>
              </div>

              <div class="col-sm-6">
                <label for="lastName" class="form-label text-primary">Last name</label>
                <input type="text" class="form-control" id="last_name" name="last_name" placeholder="" value=""
                  required>
                <div class="invalid-feedback">
                  last name is required.
                </div>
              </div>
              <div class="col-sm-6">
                <label for="firstName" class="form-label text-primary">Phone Number</label>
                <input type="phone" class="form-control" id="phone" name="phone" placeholder="1234567890" value=""
                  required>
                <div class="invalid-feedback">
                  Phone Number is required.
                </div>
              </div>


              <div class="col-12">
                <label for="email" class="form-label text-primary">Email</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required>
                <div class="invalid-feedback">
                  Please enter a valid email address for shipping updates.
                </div>
              </div>

              <div class="col-12">
                <label for="address" class="form-label text-primary">Address</label>
                <input type="text" class="form-control" id="address" name="adress" placeholder="1234 Main St" required>
                <div class="invalid-feedback">
                  Please enter your shipping address.
                </div>
              </div>

              <div class="col-12">
                <label for="address2" class="form-label text-primary">Address 2 <span
                    class="text-muted">(Optional)</span></label>
                <input type="text" class="form-control" id="address2" name="adress2" placeholder="Apartment" required>
              </div>

              <div class="col-md-5">
                <label for="country" class="form-label text-primary">Country</label>
                <input type="text" class="form-control" id="country" name="country" placeholder="country" required>

                <div class="invalid-feedback">
                  Please select a valid country.
                </div>
              </div>

              <div class="col-md-4">
                <label for="state" class="form-label text-primary">State</label>
                <input type="text" class="form-control" id="state" name="state" placeholder="State" required>
                <div class="invalid-feedback">
                  Please provide a valid state.
                </div>
              </div>

              <div class="col-md-4">
                <label for="city" class="form-label text-primary">City</label>
                <input type="text" class="form-control" id="city" name="city" placeholder="City" required>
                <div class="invalid-feedback">
                  Please provide a valid city.
                </div>
              </div>

              <div class="col-md-3">
                <label for="zip" class="form-label text-primary">Pin Code</label>
                <input type="text" class="form-control" id="zip_code" name="zip_code" placeholder="" required>
                <div class="invalid-feedback">
                  Pin code required.
                </div>
              </div>
            </div>

            <hr class="my-4">

            <button class="w-100 btn btn-primary btn-lg" type="submit">Place Order</button>
          </form>
        </div>
      </div>
    </main>

  </div>
  {% endblock %}

  {% block js %}
  <script>

    if (localStorage.getItem('cart') == null) {
      var cart = {};
    } else {
      cart = JSON.parse(localStorage.getItem('cart'));
    }


    // Example starter JavaScript for disabling form submissions if there are invalid fields
    (function () {
      'use strict'

      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.querySelectorAll('.needs-validation')

      // Loop over them and prevent submission
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }

            form.classList.add('was-validated')
          }, false)
        })
    })()
    sum = 0;
    if ($.isEmptyObject(cart)) {
      mystr = `<li class="list-group-item d-flex justify-content-between lh-sm">
              <div>
                <h6 class="my-0"> Your Cart is Empty </h6>
                <a href='/shop' id ="shopnow">Shop now </a>
              </div>
              </li>`
      $('#items').append(mystr);
    }
    else {
      my_cart  = `<a href='/shop'><button class='btn btn-primary my -2 '>Add more item</button></a>`
      for (item in cart) {
        let name = cart[item][1];
        let qty = cart[item][0];
        sum = sum + qty;
        mystr = `<li class="list-group-item d-flex justify-content-between lh-sm">
              <div>
                <h6 class="my-0">${name}</h6>

              </div>
              <span class=" badge badge-primary "><strong>${qty}</strong></span> 
              
              </li>`
        $('#items').append(mystr);
      }
      $('#items').append(my_cart)
    }

    document.getElementById('cart').innerHTML = sum;
    $('#item_json').val(JSON.stringify(cart));
    {% if thank %}
    alert("Thank for ordering us Your order id is {{id}}");
    document.location='/shop';
    localStorage.clear()
    {% endif %}
  </script>
  {% endblock %}